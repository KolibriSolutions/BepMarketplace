{% extends 'base.html' %}

{% block body %}
    <h1>All files of type {{ type }}</h1>
    <h3>Has deadline {{ type.Deadline }}</h3>
    <table class="table bordered striped datatable">
        <thead>
        <tr>
            <th data-sortable="false" data-searchable="false"><span class="mif-attachment"></span></th>
            <th>Name</th>
            <th data-sortable="false">Caption</th>
            <th>Created</th>
            <th>Updated</th>
            <th>Student</th>
            <th>Supervisors Email</th>
            <th>Supervisor Approval</th>
            <th>Approval Timestamp</th>
            <th data-sortable="false">Supervisor comments</th>
        </tr>
        </thead>
        <tbody>
        {% for file in files %}
            <tr>
                <td><span class="icon mif-file-{{ file.metro_icon }}"></span></td>
                <td><a href="{% url "download:studentfile" file.id %}" download>{{ file.OriginalName }}</a></td>
                <td>{{ file.Caption }}</td>
                <td data-sort="{{ file.Created|date:"U" }}">{{ file.Created }}</td>
                <td {% if file.TimeStamp.date <= type.Deadline %} class="success" {% else %}class="error"{% endif %}
                                                                  data-sort="{{ file.TimeStamp|date:"U" }}">{{ file.TimeStamp }}</td>
                <td {% if file.TimeStamp.date <= type.Deadline %} class="success"
                                                                  {% else %}class="error"{% endif %} >{{ file.Distribution.Student.usermeta.get_nice_name }}</td>
                <td>
                    {{ file.Distribution.Proposal.ResponsibleStaff.email }}<br/>
                    {% for ass in file.Distribution.Proposal.Assistants.all %}
                        {{ ass.email }}
                    {% endfor %}
                </td>
                <td>
                    {% if file.Type.CheckedBySupervisor %}
                        {% if file.staffreponse.Status == 'V' or file.staffreponse.Status == 'G' %}
                            {{ file.staffreponse.Status }}: <span class="mif-checkmark fg-green"></span>
                        {% elif file.staffreponse %}
                            {{ file.staffreponse.Status }}: <span class="mif-cross fg-red"></span>
                        {% else %}
                            Not yet graded.
                        {% endif %}
                    {% else %}
                        No check needed
                    {% endif %}
                </td>
                <td>
                    {% if file.Type.CheckedBySupervisor %}
                        {{ file.staffreponse.TimestampLastEdited }}
                    {% else %}
                        No check needed
                    {% endif %}
                </td>
                <td>
                    {% if file.Type.CheckedBySupervisor %}
                        {{ file.staffreponse.Explanation }}
                    {% else %}
                        No check needed
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% endblock %}

{% block scripts %}
    {{ block.super }}
    <script>
        $(document).ready(function () {
            var dt = $('.datatable').dt_wrapper();
        });
    </script>
{% endblock %}
