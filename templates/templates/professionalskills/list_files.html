{% extends 'base.html' %}

{% block body %}
    {% if type %}
        <h1>All files of type {{ type }}</h1>
        <h3>Has deadline {{ type.Deadline }}</h3>
    {% else %}
        <h1>Files list for {{ dist.Student.usermeta.get_nice_name }}</h1>
        {% if not user.groups.exists %}
            <a href="{% url 'students:addfile' %}" class="button primary">Upload a file</a>
        {% endif %}
    {% endif %}
    <table class="table bordered striped datatable">
        <thead>
        <tr>
            <th>{% if type %}Student{% else %}Type{% endif %}</th>
            <th data-sortable="false" data-searchable="false"><span class="mif-attachment"></span></th>
            <th>Name</th>
            <th data-sortable="false">Caption</th>
            <th>Created</th>
            <th>Updated</th>
            <th>Supervisors Email</th>
            <th>Supervisor feedback</th>
            {#            <th>Approval Timestamp</th>#}
            {#            <th data-sortable="false">Supervisor comments</th>#}
            <th>Rubric</th>
        </tr>
        </thead>
        <tbody>
        {% for file in files %}
            <tr>
                <td>{% if type %} {{ file.Distribution.Student.usermeta.get_nice_name }} {% else %} {{ file.Type }} {% endif %}</td>
                <td><span class="icon mif-file-{{ file.metro_icon }}"></span></td>
                <td>
                    <a href="{% url "download:studentfile" file.id %}" download>{{ file.OriginalName }}</a>
                    {% if edit %}
                        <a href="{% url 'students:editfile' file.id %}" class="button primary">Edit</a>
                    {% endif %}
                </td>
                <td>{{ file.Caption }}</td>
                <td data-sort="{{ file.Created|date:"U" }}">{{ file.Created }}</td>
                <td {% if file.TimeStamp.date <= file.Type.Deadline %} class="success" {% else %}class="error"{% endif %}
                                                                       data-sort="{{ file.TimeStamp|date:"U" }}">{{ file.TimeStamp }}</td>
                <td>
                    {{ file.Distribution.Proposal.ResponsibleStaff.email }}<br/>
                    {% for ass in file.Distribution.Proposal.Assistants.all %}
                        {{ ass.email }}
                    {% endfor %}
                </td>
                <td>
                    {% if file.Type.CheckedBySupervisor %}
                        {% if file.staffresponse.Status == 'V' or file.staffresponse.Status == 'G' %}
                            {{ file.staffresponse.Status }}: <span class="mif-checkmark fg-green"></span>
                        {% elif file.staffresponse %}
                            {{ file.staffresponse.Status }}: <span class="mif-cross fg-red"></span>
                        {% else %}
                            No feedback given.
                        {% endif %}
                    {% else %}
                        No check needed
                    {% endif %}
                </td>
                {#                <td>#}
                {#                    {% if file.Type.CheckedBySupervisor %}#}
                {#                        {{ file.staffresponse.TimestampLastEdited }}#}
                {#                    {% else %}#}
                {#                        No check needed#}
                {#                    {% endif %}#}
                {#                </td>#}
                {#                <td>#}
                {#                     {% if file.Type.CheckedBySupervisor %}#}
                {#                     {{ file.staffresponse.Explanation|default:'-' }}#}
                {#                    {% endif %}#}
                {#                </td>#}
                <td>
                    {% if file.Type.CheckedBySupervisor %}
                        {% if respond %}
                            <a href="{% url 'professionalskills:respondfile' file.id %}" class="button primary">Edit</a>
                        {% endif %}
                        <a href="{% url 'professionalskills:viewresponse' file.id %}" class="button primary">View</a>
                    {% else %}
                        No check needed
                    {% endif %}
                </td>
                {#                {% if respond %}#}
                {#                    <td>#}
                {#                    {% if file.Type.results.exists %}#}
                {#                        <a href="{% url 'results:gradeformstafffiles' file.Distribution.pk %}" class="button primary">Grades</a>#}
                {#                        {% else %}#}
                {#                        No official grade is required for this file.#}
                {#                        {% endif %}#}
                {#                    </td>{% endif %}#}
            </tr>
        {% endfor %}
        </tbody>
    </table>
{% endblock %}

{% block scripts %}
    {{ block.super }}
    <script>
        $(document).ready(function () {
            var dt = $('.datatable').dt_wrapper();
        });
    </script>
{% endblock %}
